(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/API/bluetooth"],{1624:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={data:function(){return{title:"蓝牙连接",disabled:[!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0],newDeviceLoad:!1,searchLoad:!1,maskShow:!1,equipment:[],adapterState:{discovering:!1,available:!1},connected:!1,showMaskType:"device",servicesData:[],characteristicsData:[],valueChangeData:{},isStop:!0,list:[],device:[]}},onLoad:function(){var t=this;console.log("页面加载了"),e.openBluetoothAdapter({success:function(e){console.log("初始化蓝牙成功:"+e.errMsg),console.log(JSON.stringify(e)),t.isStop=!1,t.$set(t.disabled,0,!0),t.$set(t.disabled,1,!1),t.$set(t.disabled,10,!1),t.getBluetoothAdapterState()},fail:function(e){console.log(e),console.log("初始化蓝牙失败，错误码："+(e.errCode||e.errMsg)),0!==e.errCode&&o(e.errCode,e.errMsg)}})},methods:{moveHandle:function(){},maskclose:function(){this.maskShow=!1},openBluetoothAdapter:function(){var t=this;e.openBluetoothAdapter({success:function(e){console.log("初始化蓝牙成功:"+e.errMsg),console.log(JSON.stringify(e)),t.isStop=!1,t.$set(t.disabled,0,!0),t.$set(t.disabled,1,!1),t.$set(t.disabled,10,!1),t.getBluetoothAdapterState()},fail:function(e){console.log(e),console.log("初始化蓝牙失败，错误码："+(e.errCode||e.errMsg)),0!==e.errCode&&o(e.errCode,e.errMsg)}})},queryDevices:function(){this.showMaskType="device",this.maskShow=!0},tapQuery:function(t){if("device"===this.showMaskType&&(this.$set(this.disabled,4,!1),this.equipment.length>0?this.equipment[0]=t:this.equipment.push(t),this.newDeviceLoad=!1),"service"===this.showMaskType&&(this.$set(this.disabled,6,!1),this.servicesData.length>0?(this.servicesData[0]=t,this.getBLEDeviceCharacteristics()):(this.servicesData.push(t),this.getBLEDeviceCharacteristics())),"characteristics"===this.showMaskType){this.$set(this.disabled,7,!1),this.$set(this.disabled,11,!1),e.setStorageSync("serviceId",this.servicesData),e.setStorageSync("deviceId",this.equipment),e.setStorageSync("equipmentName",this.equipment[0].name),console.log(this.equipment[0].name),this.characteristicsData.length>0?this.characteristicsData[0]=t:this.characteristicsData.push(t),e.setStorageSync("characteristicId",this.characteristicsData);this.equipment,this.servicesData,this.characteristicsData;e.navigateTo({url:"../control/control?equipment="+JSON.stringify(this.equipment)+"&servicesData="+JSON.stringify(this.servicesData)+"&characteristicsData="+JSON.stringify(this.characteristicsData),success:function(){console.log("跳转成功")},fail:function(e){console.log("跳转失败")}})}this.maskShow=!1},startBluetoothDevicesDiscovery:function(){var t=this;this.openBluetoothAdapter(),e.startBluetoothDevicesDiscovery({success:function(e){console.log("开始搜索蓝牙设备:"+e.errMsg),t.searchLoad=!0,t.$set(t.disabled,1,!0),t.$set(t.disabled,2,!1),t.$set(t.disabled,3,!1),t.onBluetoothDeviceFound()},fail:function(e){console.log("搜索蓝牙设备失败，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},stopBluetoothDevicesDiscovery:function(t){var s=this;e.stopBluetoothDevicesDiscovery({success:function(e){console.log("停止搜索蓝牙设备:"+e.errMsg),t?s.$set(s.disabled,1,!0):s.$set(s.disabled,1,!1),s.$set(s.disabled,2,!0),s.searchLoad=!1},fail:function(e){console.log("停止搜索蓝牙设备失败，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},onBluetoothDeviceFound:function(){var t=this;e.onBluetoothDeviceFound((function(e){console.log(e),console.log("开始监听寻找到新设备的事件"),t.getBluetoothDevices()}))},getBluetoothDevices:function(){var t=this;e.getBluetoothDevices({success:function(e){t.newDeviceLoad=!1,console.log("获取蓝牙设备成功:"+e.errMsg),t.list=e.devices},fail:function(e){console.log("获取蓝牙设备错误，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},getBluetoothAdapterState:function(){var t=this;console.log("---\x3e"),e.getBluetoothAdapterState({success:function(e){console.log(JSON.stringify(e)),t.adapterState=e},fail:function(e){console.log("获取本机蓝牙适配器状态失败，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},createBLEConnection:function(){var t=this,s=this.equipment[0].deviceId;e.showToast({title:"连接蓝牙...",icon:"loading",duration:99999}),e.createBLEConnection({deviceId:s,success:function(s){console.log(s),console.log("连接蓝牙成功:"+s.errMsg),e.setStorageSync("device",t.equipment),console.log(t.equipment),t.stopBluetoothDevicesDiscovery(!0),t.getBLEDeviceServices(),e.hideToast(),e.showToast({title:"连接成功",icon:"success",duration:2e3}),t.$set(t.disabled,3,!0),t.$set(t.disabled,5,!1),t.$set(t.disabled,9,!1),t.connected=!0,console.log("走到了这里"),console.log("这里也走到了")},fail:function(e){console.log("连接低功耗蓝牙失败，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},closeBLEConnection:function(){var t=this,s=this.equipment[0].deviceId;e.closeBLEConnection({deviceId:s,success:function(e){console.log(e),console.log("断开低功耗蓝牙成功:"+e.errMsg),t.$set(t.disabled,1,!1),t.$set(t.disabled,3,!0),t.$set(t.disabled,4,!0),t.$set(t.disabled,5,!0),t.$set(t.disabled,6,!0),t.$set(t.disabled,7,!0),t.$set(t.disabled,8,!0),t.$set(t.disabled,9,!0),t.$set(t.disabled,11,!0),t.equipment=[],t.servicesData=[],t.characteristicsData=[]},fail:function(e){console.log("断开低功耗蓝牙成功，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},getBLEDeviceServices:function(){var t=this,s=this.equipment[0].deviceId;console.log("获取所有服务的 uuid:"+s),e.getBLEDeviceServices({deviceId:s,success:function(e){if(console.log(JSON.stringify(e.services)),console.log("获取设备服务成功:"+e.errMsg),t.$set(t.disabled,7,!0),t.$set(t.disabled,8,!0),t.showMaskType="service",t.list=e.services,t.characteristicsData=[],console.log(t.list),t.list.length<=0)i("获取服务失败，请重试!");else{var s=t.list[0];t.tapQuery(s)}},fail:function(e){console.log("获取设备服务失败，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},getBLEDeviceCharacteristics:function(){var t=this,s=this.equipment[0].deviceId,c=this.servicesData[0].uuid;console.log("这里也也走到了"),console.log(s),console.log(c),e.getBLEDeviceCharacteristics({deviceId:s,serviceId:c,success:function(e){if(console.log(JSON.stringify(e)),console.log("获取特征值成功:"+e.errMsg),t.$set(t.disabled,7,!0),t.valueChangeData={},t.showMaskType="characteristics",t.list=e.characteristics,console.log(t.list),t.list.length<=0)i("获取特征值失败，请重试!");else{console.log(t.list.length);for(var s=t.list.length-1;s>=0;s--)if(1==t.list[s].properties.write){var o=t.list[s];console.log(o),t.tapQuery(o),console.log("页面马上跳转喽")}}},fail:function(e){console.log("获取特征值失败，错误码："+e.errCode),0!==e.errCode&&o(e.errCode)}})},closeBluetoothAdapter:function(t){var s=this;e.closeBluetoothAdapter({success:function(e){console.log("断开蓝牙模块成功"),s.isStop=!0,s.$set(s.disabled,0,!1),s.$set(s.disabled,1,!1),s.$set(s.disabled,2,!0),s.$set(s.disabled,3,!0),s.$set(s.disabled,4,!0),s.$set(s.disabled,5,!0),s.$set(s.disabled,6,!0),s.$set(s.disabled,7,!0),s.$set(s.disabled,8,!0),s.$set(s.disabled,9,!0),s.$set(s.disabled,10,!0),s.equipment=[],s.servicesData=[],s.characteristicsData=[],s.valueChangeData={},s.adapterState=[],s.searchLoad=!1,i("断开蓝牙模块")}})},navigateBack:function(){e.navigateBack()}}};function o(e,t){switch(e){case 1e4:i("未初始化蓝牙适配器");break;case 10001:i("未检测到蓝牙，请打开蓝牙重试！");break;case 10002:i("没有找到指定设备");break;case 10003:i("连接失败");break;case 10004:i("没有找到指定服务");break;case 10005:i("没有找到指定特征值");break;case 10006:i("当前连接已断开");break;case 10007:i("当前特征值不支持此操作");break;case 10008:i("其余所有系统上报的异常");break;case 10009:i("Android 系统特有，系统版本低于 4.3 不支持 BLE");break;default:i(t)}}function i(t){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.showModal({title:"提示",content:t,showCancel:s})}t.default=s}).call(this,s("543d")["default"])},"2df8":function(e,t,s){"use strict";var o;s.d(t,"b",(function(){return i})),s.d(t,"c",(function(){return c})),s.d(t,"a",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},c=[]},6552:function(e,t,s){"use strict";s.r(t);var o=s("1624"),i=s.n(o);for(var c in o)"default"!==c&&function(e){s.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},bc94:function(e,t,s){},eec5:function(e,t,s){"use strict";(function(e){s("9f88");o(s("66fd"));var t=o(s("f757"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=s,e(t.default)}).call(this,s("543d")["createPage"])},ef36:function(e,t,s){"use strict";var o=s("bc94"),i=s.n(o);i.a},f757:function(e,t,s){"use strict";s.r(t);var o=s("2df8"),i=s("6552");for(var c in i)"default"!==c&&function(e){s.d(t,e,(function(){return i[e]}))}(c);s("ef36");var a,n=s("f0c5"),r=Object(n["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=r.exports}},[["eec5","common/runtime","common/vendor"]]]);